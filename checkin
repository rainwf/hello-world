
domsg()
{
me=`whoami`
msg "$me" $1
if [ $? -ne 0 ]
then 
    echo $1
fi
return
}


# main
if [ $# -ne 1 ]
then
    echo Missing filename
    echo Usage: checkin filename
    exit 1
fi
me=`whoami`
#git_root=`git rev-parse --show-toplevel`
git lfs lock .gitattributes >/dev/null
locked=`git lfs locks | grep .gitattributes`
github_username=`echo $locked | cut -d ' ' -f2`
git lfs unlock .gitattributes >/dev/null
locked=`git lfs locks | grep $1` 
if [ $? -eq 0 ] 
then 
    echo $locked | grep $github_username >/dev/null 
    if [ $? -eq 0 ] 
    then 
        git add $1 >/dev/null
        git commit -m "checkin" >/dev/null
#		gitid=`git lfs ls-files -l -I $1 | cut -d ' ' -f1`
#		git lfs push --object-id origin $gitid
        git push origin master >/dev/null
        if [ $? -ne 0 ] 
        then 
            domsg "checkin failed: $1 push failed"
        else
            git lfs unlock $1 > /dev/null
        fi
    else
        who=`echo $locked | cut -d ' ' -f2`
        domsg "checkin failed: $1 checked out by $who"
    fi
else 
    domsg "checkin failed: $1 not locked"
fi

